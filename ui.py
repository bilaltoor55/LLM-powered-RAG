import os
import time
import streamlit as st
from langchain_community.llms import Ollama
from document_loader import load_documents_into_database
from models import get_list_of_models
from llm import getStreamingChain

# Define persistent upload folder
UPLOAD_FOLDER = "/mnt/uploads"

# Ensure the folder exists
if not os.path.exists(UPLOAD_FOLDER):
    os.makedirs(UPLOAD_FOLDER)

# Constants
EMBEDDING_MODEL = "nomic-embed-text"

# Title
st.markdown("<h2 style='text-align: center;'>LLM Chatbot RAG Assistant ðŸ“š</h2>", unsafe_allow_html=True)

# Sidebar SVG Logo
svg_logo = """<div style="margin-bottom: 20px;">
<svg xmlns="http://www.w3.org/2000/svg" width="250" height="100" viewBox="0 0 857 310" fill="none">
<g clip-path="url(#clip0_2051_176)">
<path d="M320.716 135.664V136.475H318.151V143.398H317.096V136.475H314.531V135.664H320.716Z" fill="#016DD3"/>
<path d="M321.451 143.398V135.664H322.789L325.782 142.117L328.719 135.664H330V143.398H329.059V137.054L326.164 143.398H325.331L322.389 137.054V143.398H321.451Z" fill="#016DD3"/>
<path d="M57.2687 152.536C57.2687 170.342 65.3103 179.245 81.3942 179.245C97.1396 179.245 105.012 170.342 105.012 152.536C105.012 134.976 97.1396 126.197 81.3942 126.197C65.3103 126.197 57.2687 134.976 57.2687 152.536ZM48.2733 152.813C48.2733 130.456 59.3136 119.277 81.3942 119.277C103.137 119.277 114.008 130.456 114.008 152.813C114.008 175.048 103.137 186.165 81.3942 186.165C59.3136 186.165 48.2733 175.048 48.2733 152.813Z" fill="#016DD3"/>
<path d="M122.258 185.703V137.268H128.024L129.546 143.449C133.79 139.328 138.895 137.268 144.861 137.268V144.371C139.079 144.371 134.39 146.417 130.791 150.507V185.703H122.258Z" fill="#016DD3"/>
<path d="M158.646 137.268V185.703H150.112V137.268H158.646ZM158.646 119.738V127.811H150.112V119.738H158.646Z" fill="#016DD3"/>
<path d="M201.585 145.478C198.664 144.741 195.05 144.371 190.745 144.371C180.443 144.371 175.292 149.953 175.292 161.116C175.292 172.587 180.166 178.323 189.915 178.323C194.343 178.323 198.233 177.492 201.585 175.832V145.478ZM210.119 185.703C210.119 197.39 202.693 203.233 187.839 203.233C181.873 203.233 176.583 202.464 171.97 200.926V194.007C176.676 195.544 181.996 196.313 187.931 196.313C197.034 196.313 201.585 192.776 201.585 185.703V183.397C197.956 184.935 194.051 185.703 189.869 185.703C174.554 185.703 166.896 177.538 166.896 161.209C166.896 145.248 174.969 137.268 191.114 137.268C197.664 137.268 204 137.929 210.119 139.251V185.703Z" fill="#016DD3"/>
<path d="M239.727 137.268C253.504 137.268 260.393 144.079 260.393 157.703C260.393 159.64 260.254 161.716 259.978 163.93H225.98C225.98 173.833 231.762 178.784 243.325 178.784C248.83 178.784 253.719 178.169 257.993 176.939V183.858C253.719 185.088 248.522 185.703 242.403 185.703C225.765 185.703 217.447 177.446 217.447 160.932C217.447 145.156 224.873 137.268 239.727 137.268ZM225.98 156.826H252.182C251.997 148.339 247.846 144.095 239.727 144.095C231.116 144.095 226.534 148.339 225.98 156.826Z" fill="#016DD3"/>
<path d="M267.627 185.703V137.268H273.395L274.916 143.449C279.868 139.328 285.311 137.268 291.246 137.268C303.332 137.268 309.375 143.28 309.375 155.304V185.703H300.841V155.166C300.841 147.97 297.258 144.371 290.093 144.371C285.203 144.371 280.559 146.417 276.161 150.507V185.703H267.627Z" fill="#016DD3"/>
<path d="M0 111.475C0 107.748 3.02123 104.727 6.74806 104.727H29.2416C32.9685 104.727 35.9899 107.748 35.9899 111.475V133.968C35.9899 137.695 32.9685 140.716 29.2416 140.716H6.74806C3.02123 140.716 0 137.695 0 133.968V111.475Z" fill="#016DD3"/>
</g>
<path d="M367 305L367 4.99999" stroke="#FFB72C" stroke-width="10" stroke-linecap="round"/>
<path d="M426.464 140.54C422.252 140.54 418.688 139.748 415.772 138.164C412.892 136.58 410.696 134.33 409.184 131.414C407.672 128.498 406.916 125.042 406.916 121.046C406.916 118.022 407.348 115.304 408.212 112.892C409.112 110.48 410.39 108.428 412.046 106.736C413.738 105.008 415.79 103.694 418.202 102.794C420.614 101.858 423.35 101.39 426.41 101.39C428.426 101.39 430.442 101.642 432.458 102.146C434.51 102.614 436.436 103.424 438.236 104.576C438.848 104.972 439.244 105.458 439.424 106.034C439.64 106.61 439.676 107.204 439.532 107.816C439.388 108.392 439.118 108.896 438.722 109.328C438.326 109.76 437.822 110.03 437.21 110.138C436.634 110.246 435.986 110.102 435.266 109.706C433.898 108.914 432.512 108.338 431.108 107.978C429.704 107.618 428.138 107.438 426.41 107.438C423.746 107.438 421.496 107.978 419.66 109.058C417.824 110.102 416.438 111.632 415.502 113.648C414.602 115.664 414.152 118.13 414.152 121.046C414.152 125.474 415.214 128.84 417.338 131.144C419.462 133.448 422.612 134.6 426.788 134.6C428.228 134.6 429.686 134.456 431.162 134.168C432.638 133.88 434.078 133.484 435.482 132.98L434.132 136.058V124.556H428.192C427.292 124.556 426.59 124.322 426.086 123.854C425.618 123.386 425.384 122.756 425.384 121.964C425.384 121.136 425.618 120.506 426.086 120.074C426.59 119.642 427.292 119.426 428.192 119.426H437.102C438.002 119.426 438.686 119.678 439.154 120.182C439.658 120.65 439.91 121.334 439.91 122.234V135.356C439.91 136.148 439.748 136.814 439.424 137.354C439.136 137.894 438.65 138.29 437.966 138.542C436.382 139.118 434.564 139.604 432.512 140C430.46 140.36 428.444 140.54 426.464 140.54ZM450.728 140.432C449.612 140.432 448.748 140.144 448.136 139.568C447.56 138.956 447.272 138.092 447.272 136.976V116.564C447.272 115.448 447.56 114.602 448.136 114.026C448.712 113.45 449.522 113.162 450.566 113.162C451.61 113.162 452.42 113.45 452.996 114.026C453.572 114.602 453.86 115.448 453.86 116.564V119.966H453.32C453.824 117.806 454.814 116.168 456.29 115.052C457.766 113.936 459.728 113.27 462.176 113.054C462.932 112.982 463.526 113.18 463.958 113.648C464.426 114.08 464.696 114.764 464.768 115.7C464.84 116.6 464.624 117.338 464.12 117.914C463.652 118.454 462.932 118.778 461.96 118.886L460.772 118.994C458.576 119.21 456.92 119.894 455.804 121.046C454.688 122.162 454.13 123.746 454.13 125.798V136.976C454.13 138.092 453.842 138.956 453.266 139.568C452.69 140.144 451.844 140.432 450.728 140.432ZM481.01 140.54C478.022 140.54 475.448 139.982 473.288 138.866C471.128 137.75 469.454 136.166 468.266 134.114C467.114 132.062 466.538 129.632 466.538 126.824C466.538 124.088 467.096 121.694 468.212 119.642C469.364 117.59 470.93 115.988 472.91 114.836C474.926 113.648 477.212 113.054 479.768 113.054C481.64 113.054 483.314 113.36 484.79 113.972C486.302 114.584 487.58 115.466 488.624 116.618C489.704 117.77 490.514 119.174 491.054 120.83C491.63 122.45 491.918 124.286 491.918 126.338C491.918 126.986 491.684 127.49 491.216 127.85C490.784 128.174 490.154 128.336 489.326 128.336H471.992V124.448H487.166L486.302 125.258C486.302 123.602 486.05 122.216 485.546 121.1C485.078 119.984 484.376 119.138 483.44 118.562C482.54 117.95 481.406 117.644 480.038 117.644C478.526 117.644 477.23 118.004 476.15 118.724C475.106 119.408 474.296 120.398 473.72 121.694C473.18 122.954 472.91 124.466 472.91 126.23V126.608C472.91 129.56 473.594 131.774 474.962 133.25C476.366 134.69 478.418 135.41 481.118 135.41C482.054 135.41 483.098 135.302 484.25 135.086C485.438 134.834 486.554 134.42 487.598 133.844C488.354 133.412 489.02 133.232 489.596 133.304C490.172 133.34 490.622 133.538 490.946 133.898C491.306 134.258 491.522 134.708 491.594 135.248C491.666 135.752 491.558 136.274 491.27 136.814C491.018 137.354 490.568 137.822 489.92 138.218C488.66 139.01 487.202 139.604 485.546 140C483.926 140.36 482.414 140.54 481.01 140.54ZM505.958 140.54C504.05 140.54 502.34 140.18 500.828 139.46C499.352 138.704 498.182 137.696 497.318 136.436C496.49 135.176 496.076 133.754 496.076 132.17C496.076 130.226 496.58 128.696 497.588 127.58C498.596 126.428 500.234 125.6 502.502 125.096C504.77 124.592 507.812 124.34 511.628 124.34H514.328V128.228H511.682C509.45 128.228 507.668 128.336 506.336 128.552C505.004 128.768 504.05 129.146 503.474 129.686C502.934 130.19 502.664 130.91 502.664 131.846C502.664 133.034 503.078 134.006 503.906 134.762C504.734 135.518 505.886 135.896 507.362 135.896C508.55 135.896 509.594 135.626 510.494 135.086C511.43 134.51 512.168 133.736 512.708 132.764C513.248 131.792 513.518 130.676 513.518 129.416V123.206C513.518 121.406 513.122 120.11 512.33 119.318C511.538 118.526 510.206 118.13 508.334 118.13C507.29 118.13 506.156 118.256 504.932 118.508C503.744 118.76 502.484 119.192 501.152 119.804C500.468 120.128 499.856 120.218 499.316 120.074C498.812 119.93 498.416 119.642 498.128 119.21C497.84 118.742 497.696 118.238 497.696 117.698C497.696 117.158 497.84 116.636 498.128 116.132C498.416 115.592 498.902 115.196 499.586 114.944C501.242 114.26 502.826 113.774 504.338 113.486C505.886 113.198 507.29 113.054 508.55 113.054C511.142 113.054 513.266 113.45 514.922 114.242C516.614 115.034 517.874 116.24 518.702 117.86C519.53 119.444 519.944 121.496 519.944 124.016V136.976C519.944 138.092 519.674 138.956 519.134 139.568C518.594 140.144 517.82 140.432 516.812 140.432C515.804 140.432 515.012 140.144 514.436 139.568C513.896 138.956 513.626 138.092 513.626 136.976V134.384H514.058C513.806 135.644 513.302 136.742 512.546 137.678C511.826 138.578 510.908 139.28 509.792 139.784C508.676 140.288 507.398 140.54 505.958 140.54ZM538.891 140.54C536.551 140.54 534.589 140.144 533.005 139.352C531.457 138.56 530.305 137.408 529.549 135.896C528.793 134.348 528.415 132.44 528.415 130.172V118.67H525.607C524.743 118.67 524.077 118.454 523.609 118.022C523.141 117.554 522.907 116.924 522.907 116.132C522.907 115.304 523.141 114.674 523.609 114.242C524.077 113.81 524.743 113.594 525.607 113.594H528.415V108.68C528.415 107.564 528.703 106.718 529.279 106.142C529.891 105.566 530.737 105.278 531.817 105.278C532.897 105.278 533.725 105.566 534.301 106.142C534.877 106.718 535.165 107.564 535.165 108.68V113.594H540.889C541.753 113.594 542.419 113.81 542.887 114.242C543.355 114.674 543.589 115.304 543.589 116.132C543.589 116.924 543.355 117.554 542.887 118.022C542.419 118.454 541.753 118.67 540.889 118.67H535.165V129.794C535.165 131.522 535.543 132.818 536.299 133.682C537.055 134.546 538.279 134.978 539.971 134.978C540.583 134.978 541.123 134.924 541.591 134.816C542.059 134.708 542.473 134.636 542.833 134.6C543.265 134.564 543.625 134.708 543.913 135.032C544.201 135.32 544.345 135.932 544.345 136.868C544.345 137.588 544.219 138.236 543.967 138.812C543.751 139.352 543.337 139.73 542.725 139.946C542.257 140.09 541.645 140.216 540.889 140.324C540.133 140.468 539.467 140.54 538.891 140.54ZM575.464 140.432C574.348 140.432 573.484 140.126 572.872 139.514C572.296 138.866 572.008 137.984 572.008 136.868V107.708H561.478C560.542 107.708 559.804 107.456 559.264 106.952C558.76 106.412 558.508 105.692 558.508 104.792C558.508 103.856 558.76 103.154 559.264 102.686C559.804 102.182 560.542 101.93 561.478 101.93H589.45C590.386 101.93 591.106 102.182 591.61 102.686C592.15 103.154 592.42 103.856 592.42 104.792C592.42 105.692 592.15 106.412 591.61 106.952C591.106 107.456 590.386 107.708 589.45 107.708H578.92V136.868C578.92 137.984 578.632 138.866 578.056 139.514C577.48 140.126 576.616 140.432 575.464 140.432ZM604.514 140.54C601.526 140.54 598.952 139.982 596.792 138.866C594.632 137.75 592.958 136.166 591.77 134.114C590.618 132.062 590.042 129.632 590.042 126.824C590.042 124.088 590.6 121.694 591.716 119.642C592.868 117.59 594.434 115.988 596.414 114.836C598.43 113.648 600.716 113.054 603.272 113.054C605.144 113.054 606.818 113.36 608.294 113.972C609.806 114.584 611.084 115.466 612.128 116.618C613.208 117.77 614.018 119.174 614.558 120.83C615.134 122.45 615.422 124.286 615.422 126.338C615.422 126.986 615.188 127.49 614.72 127.85C614.288 128.174 613.658 128.336 612.83 128.336H595.496V124.448H610.67L609.806 125.258C609.806 123.602 609.554 122.216 609.05 121.1C608.582 119.984 607.88 119.138 606.944 118.562C606.044 117.95 604.91 117.644 603.542 117.644C602.03 117.644 600.734 118.004 599.654 118.724C598.61 119.408 597.8 120.398 597.224 121.694C596.684 122.954 596.414 124.466 596.414 126.23V126.608C596.414 129.56 597.098 131.774 598.466 133.25C599.87 134.69 601.922 135.41 604.622 135.41C605.558 135.41 606.602 135.302 607.754 135.086C608.942 134.834 610.058 134.42 611.102 133.844C611.858 133.412 612.524 133.232 613.1 133.304C613.676 133.34 614.126 133.538 614.45 133.898C614.81 134.258 615.026 134.708 615.098 135.248C615.17 135.752 615.062 136.274 614.774 136.814C614.522 137.354 614.072 137.822 613.424 138.218C612.164 139.01 610.706 139.604 609.05 140C607.43 140.36 605.918 140.54 604.514 140.54ZM632.972 140.54C630.2 140.54 627.788 139.982 625.736 138.866C623.684 137.714 622.1 136.094 620.984 134.006C619.868 131.918 619.31 129.47 619.31 126.662C619.31 124.538 619.616 122.648 620.228 120.992C620.876 119.3 621.794 117.878 622.982 116.726C624.17 115.538 625.61 114.638 627.302 114.026C628.994 113.378 630.884 113.054 632.972 113.054C634.16 113.054 635.438 113.216 636.806 113.54C638.21 113.864 639.524 114.404 640.748 115.16C641.324 115.52 641.702 115.952 641.882 116.456C642.062 116.96 642.098 117.482 641.99 118.022C641.882 118.526 641.648 118.976 641.288 119.372C640.964 119.732 640.55 119.966 640.046 120.074C639.542 120.146 638.984 120.02 638.372 119.696C637.58 119.228 636.77 118.886 635.942 118.67C635.114 118.418 634.322 118.292 633.566 118.292C632.378 118.292 631.334 118.49 630.434 118.886C629.534 119.246 628.76 119.786 628.112 120.506C627.5 121.19 627.032 122.054 626.708 123.098C626.384 124.142 626.222 125.348 626.222 126.716C626.222 129.38 626.852 131.486 628.112 133.034C629.408 134.546 631.226 135.302 633.566 135.302C634.322 135.302 635.096 135.194 635.888 134.978C636.716 134.762 637.544 134.42 638.372 133.952C638.984 133.628 639.524 133.52 639.992 133.628C640.496 133.736 640.91 133.988 641.234 134.384C641.558 134.744 641.756 135.194 641.828 135.734C641.9 136.238 641.828 136.742 641.612 137.246C641.432 137.75 641.072 138.164 640.532 138.488C639.344 139.208 638.084 139.73 636.752 140.054C635.42 140.378 634.16 140.54 632.972 140.54ZM649.587 140.432C648.507 140.432 647.679 140.144 647.103 139.568C646.527 138.956 646.239 138.092 646.239 136.976V104.9C646.239 103.784 646.527 102.938 647.103 102.362C647.679 101.786 648.507 101.498 649.587 101.498C650.667 101.498 651.495 101.786 652.071 102.362C652.683 102.938 652.989 103.784 652.989 104.9V118.886H652.233C653.025 116.978 654.249 115.538 655.905 114.566C657.597 113.558 659.505 113.054 661.629 113.054C663.753 113.054 665.499 113.45 666.867 114.242C668.235 115.034 669.261 116.24 669.945 117.86C670.629 119.444 670.971 121.46 670.971 123.908V136.976C670.971 138.092 670.683 138.956 670.107 139.568C669.531 140.144 668.703 140.432 667.623 140.432C666.543 140.432 665.697 140.144 665.085 139.568C664.509 138.956 664.221 138.092 664.221 136.976V124.232C664.221 122.18 663.825 120.686 663.033 119.75C662.277 118.814 661.089 118.346 659.469 118.346C657.489 118.346 655.905 118.976 654.717 120.236C653.565 121.46 652.989 123.098 652.989 125.15V136.976C652.989 139.28 651.855 140.432 649.587 140.432ZM681.174 140.432C680.094 140.432 679.266 140.144 678.69 139.568C678.114 138.956 677.826 138.092 677.826 136.976V116.564C677.826 115.448 678.114 114.602 678.69 114.026C679.266 113.45 680.076 113.162 681.12 113.162C682.164 113.162 682.974 113.45 683.55 114.026C684.126 114.602 684.414 115.448 684.414 116.564V120.236L683.82 118.886C684.612 116.978 685.836 115.538 687.492 114.566C689.184 113.558 691.092 113.054 693.216 113.054C695.34 113.054 697.086 113.45 698.454 114.242C699.822 115.034 700.848 116.24 701.532 117.86C702.216 119.444 702.558 121.46 702.558 123.908V136.976C702.558 138.092 702.27 138.956 701.694 139.568C701.118 140.144 700.29 140.432 699.21 140.432C698.13 140.432 697.284 140.144 696.672 139.568C696.096 138.956 695.808 138.092 695.808 136.976V124.232C695.808 122.18 695.412 120.686 694.62 119.75C693.864 118.814 692.676 118.346 691.056 118.346C689.076 118.346 687.492 118.976 686.304 120.236C685.152 121.46 684.576 123.098 684.576 125.15V136.976C684.576 139.28 683.442 140.432 681.174 140.432ZM721.456 140.54C718.72 140.54 716.344 139.982 714.328 138.866C712.312 137.75 710.746 136.166 709.63 134.114C708.514 132.026 707.956 129.578 707.956 126.77C707.956 124.646 708.262 122.756 708.874 121.1C709.522 119.408 710.44 117.968 711.628 116.78C712.816 115.556 714.238 114.638 715.894 114.026C717.55 113.378 719.404 113.054 721.456 113.054C724.192 113.054 726.568 113.612 728.584 114.728C730.6 115.844 732.166 117.428 733.282 119.48C734.398 121.532 734.956 123.962 734.956 126.77C734.956 128.894 734.632 130.802 733.984 132.494C733.372 134.186 732.472 135.644 731.284 136.868C730.096 138.056 728.674 138.974 727.018 139.622C725.362 140.234 723.508 140.54 721.456 140.54ZM721.456 135.41C722.788 135.41 723.958 135.086 724.966 134.438C725.974 133.79 726.748 132.836 727.288 131.576C727.864 130.28 728.152 128.678 728.152 126.77C728.152 123.89 727.54 121.748 726.316 120.344C725.092 118.904 723.472 118.184 721.456 118.184C720.124 118.184 718.954 118.508 717.946 119.156C716.938 119.768 716.146 120.722 715.57 122.018C715.03 123.278 714.76 124.862 714.76 126.77C714.76 129.614 715.372 131.774 716.596 133.25C717.82 134.69 719.44 135.41 721.456 135.41ZM749.546 140.54C746.558 140.54 744.308 139.694 742.796 138.002C741.284 136.274 740.528 133.754 740.528 130.442V104.9C740.528 103.784 740.816 102.938 741.392 102.362C741.968 101.786 742.796 101.498 743.876 101.498C744.956 101.498 745.784 101.786 746.36 102.362C746.972 102.938 747.278 103.784 747.278 104.9V130.118C747.278 131.774 747.62 132.998 748.304 133.79C749.024 134.582 750.032 134.978 751.328 134.978C751.616 134.978 751.886 134.978 752.138 134.978C752.39 134.942 752.642 134.906 752.894 134.87C753.398 134.798 753.74 134.942 753.92 135.302C754.1 135.626 754.19 136.31 754.19 137.354C754.19 138.254 754.01 138.956 753.65 139.46C753.29 139.964 752.696 140.27 751.868 140.378C751.508 140.414 751.13 140.45 750.734 140.486C750.338 140.522 749.942 140.54 749.546 140.54ZM769.55 140.54C766.814 140.54 764.438 139.982 762.422 138.866C760.406 137.75 758.84 136.166 757.724 134.114C756.608 132.026 756.05 129.578 756.05 126.77C756.05 124.646 756.356 122.756 756.968 121.1C757.616 119.408 758.534 117.968 759.722 116.78C760.91 115.556 762.332 114.638 763.988 114.026C765.644 113.378 767.498 113.054 769.55 113.054C772.286 113.054 774.662 113.612 776.678 114.728C778.694 115.844 780.26 117.428 781.376 119.48C782.492 121.532 783.05 123.962 783.05 126.77C783.05 128.894 782.726 130.802 782.078 132.494C781.466 134.186 780.566 135.644 779.378 136.868C778.19 138.056 776.768 138.974 775.112 139.622C773.456 140.234 771.602 140.54 769.55 140.54ZM769.55 135.41C770.882 135.41 772.052 135.086 773.06 134.438C774.068 133.79 774.842 132.836 775.382 131.576C775.958 130.28 776.246 128.678 776.246 126.77C776.246 123.89 775.634 121.748 774.41 120.344C773.186 118.904 771.566 118.184 769.55 118.184C768.218 118.184 767.048 118.508 766.04 119.156C765.032 119.768 764.24 120.722 763.664 122.018C763.124 123.278 762.854 124.862 762.854 126.77C762.854 129.614 763.466 131.774 764.69 133.25C765.914 134.69 767.534 135.41 769.55 135.41ZM800.933 150.26C798.989 150.26 797.099 150.08 795.263 149.72C793.463 149.36 791.825 148.802 790.349 148.046C789.665 147.686 789.197 147.254 788.945 146.75C788.729 146.246 788.657 145.724 788.729 145.184C788.837 144.68 789.053 144.23 789.377 143.834C789.737 143.438 790.169 143.168 790.673 143.024C791.177 142.88 791.699 142.952 792.239 143.24C793.823 144.032 795.317 144.536 796.721 144.752C798.161 145.004 799.385 145.13 800.393 145.13C802.805 145.13 804.605 144.536 805.793 143.348C807.017 142.196 807.629 140.468 807.629 138.164V133.304H808.115C807.575 135.14 806.441 136.616 804.713 137.732C803.021 138.812 801.095 139.352 798.935 139.352C796.559 139.352 794.489 138.812 792.725 137.732C790.961 136.616 789.593 135.068 788.621 133.088C787.649 131.108 787.163 128.804 787.163 126.176C787.163 124.196 787.433 122.414 787.973 120.83C788.549 119.21 789.341 117.824 790.349 116.672C791.393 115.52 792.635 114.638 794.075 114.026C795.551 113.378 797.171 113.054 798.935 113.054C801.167 113.054 803.111 113.612 804.767 114.728C806.459 115.808 807.557 117.248 808.061 119.048L807.521 120.398V116.564C807.521 115.448 807.809 114.602 808.385 114.026C808.997 113.45 809.825 113.162 810.869 113.162C811.949 113.162 812.777 113.45 813.353 114.026C813.929 114.602 814.217 115.448 814.217 116.564V137.354C814.217 141.638 813.083 144.86 810.815 147.02C808.547 149.18 805.253 150.26 800.933 150.26ZM800.771 134.222C802.175 134.222 803.381 133.898 804.389 133.25C805.397 132.602 806.171 131.684 806.711 130.496C807.287 129.272 807.575 127.832 807.575 126.176C807.575 123.692 806.963 121.748 805.739 120.344C804.515 118.904 802.859 118.184 800.771 118.184C799.367 118.184 798.161 118.508 797.153 119.156C796.145 119.804 795.353 120.722 794.777 121.91C794.237 123.098 793.967 124.52 793.967 126.176C793.967 128.66 794.579 130.622 795.803 132.062C797.027 133.502 798.683 134.222 800.771 134.222ZM827.907 150.152C827.115 150.152 826.467 149.936 825.963 149.504C825.459 149.108 825.153 148.568 825.045 147.884C824.973 147.2 825.099 146.48 825.423 145.724L829.095 137.57V140.378L819.267 117.644C818.943 116.852 818.835 116.114 818.943 115.43C819.051 114.746 819.375 114.206 819.915 113.81C820.491 113.378 821.265 113.162 822.237 113.162C823.065 113.162 823.731 113.36 824.235 113.756C824.739 114.116 825.189 114.818 825.585 115.862L832.875 134.06H831.255L838.707 115.808C839.103 114.8 839.571 114.116 840.111 113.756C840.651 113.36 841.371 113.162 842.271 113.162C843.063 113.162 843.693 113.378 844.161 113.81C844.629 114.206 844.917 114.746 845.025 115.43C845.133 116.078 845.007 116.798 844.647 117.59L831.525 147.56C831.057 148.568 830.553 149.252 830.013 149.612C829.473 149.972 828.771 150.152 827.907 150.152ZM851.155 145.778C850.687 146.354 850.183 146.678 849.643 146.75C849.139 146.858 848.689 146.768 848.293 146.48C847.897 146.192 847.681 145.778 847.645 145.238C847.609 144.734 847.843 144.176 848.347 143.564C849.067 142.664 849.553 141.764 849.805 140.864C850.057 139.964 850.183 139.154 850.183 138.434L850.453 140.27C849.193 140.27 848.167 139.91 847.375 139.19C846.619 138.434 846.241 137.444 846.241 136.22C846.241 135.068 846.601 134.132 847.321 133.412C848.041 132.656 849.013 132.278 850.237 132.278C851.497 132.278 852.487 132.71 853.207 133.574C853.927 134.402 854.287 135.608 854.287 137.192C854.287 138.056 854.197 138.956 854.017 139.892C853.873 140.792 853.567 141.728 853.099 142.7C852.667 143.708 852.019 144.734 851.155 145.778ZM421.28 206.54C419.696 206.54 418.112 206.414 416.528 206.162C414.944 205.946 413.45 205.604 412.046 205.136C410.642 204.632 409.382 204.02 408.266 203.3C407.618 202.868 407.168 202.346 406.916 201.734C406.664 201.122 406.574 200.528 406.646 199.952C406.754 199.34 406.988 198.818 407.348 198.386C407.744 197.918 408.23 197.63 408.806 197.522C409.382 197.414 410.012 197.576 410.696 198.008C412.28 198.944 413.954 199.628 415.718 200.06C417.482 200.492 419.336 200.708 421.28 200.708C424.124 200.708 426.194 200.24 427.49 199.304C428.786 198.332 429.434 197.09 429.434 195.578C429.434 194.318 428.966 193.328 428.03 192.608C427.13 191.888 425.564 191.294 423.332 190.826L417.392 189.584C413.972 188.864 411.416 187.658 409.724 185.966C408.068 184.238 407.24 181.97 407.24 179.162C407.24 177.398 407.6 175.796 408.32 174.356C409.04 172.916 410.048 171.674 411.344 170.63C412.676 169.586 414.242 168.794 416.042 168.254C417.878 167.678 419.894 167.39 422.09 167.39C424.25 167.39 426.302 167.66 428.246 168.2C430.19 168.74 431.936 169.532 433.484 170.576C434.06 170.972 434.438 171.458 434.618 172.034C434.834 172.61 434.888 173.186 434.78 173.762C434.672 174.302 434.42 174.77 434.024 175.166C433.628 175.562 433.124 175.796 432.512 175.868C431.936 175.94 431.27 175.76 430.514 175.328C429.182 174.572 427.832 174.032 426.464 173.708C425.096 173.384 423.62 173.222 422.036 173.222C420.38 173.222 418.958 173.456 417.77 173.924C416.582 174.392 415.664 175.058 415.016 175.922C414.404 176.75 414.098 177.74 414.098 178.892C414.098 180.188 414.53 181.232 415.394 182.024C416.258 182.78 417.734 183.374 419.822 183.806L425.708 185.048C429.272 185.804 431.918 186.992 433.646 188.612C435.41 190.232 436.292 192.392 436.292 195.092C436.292 196.82 435.932 198.386 435.212 199.79C434.528 201.194 433.52 202.4 432.188 203.408C430.892 204.416 429.326 205.19 427.49 205.73C425.654 206.27 423.584 206.54 421.28 206.54ZM445.032 206.432C443.952 206.432 443.124 206.144 442.548 205.568C441.972 204.956 441.684 204.092 441.684 202.976V182.564C441.684 181.448 441.972 180.602 442.548 180.026C443.124 179.45 443.934 179.162 444.978 179.162C446.022 179.162 446.832 179.45 447.408 180.026C447.984 180.602 448.272 181.448 448.272 182.564V186.506L447.678 184.886C448.398 183.086 449.514 181.664 451.026 180.62C452.538 179.576 454.338 179.054 456.426 179.054C458.55 179.054 460.296 179.558 461.664 180.566C463.032 181.574 463.986 183.122 464.526 185.21H463.77C464.49 183.302 465.678 181.808 467.334 180.728C468.99 179.612 470.898 179.054 473.058 179.054C475.074 179.054 476.73 179.45 478.026 180.242C479.358 181.034 480.348 182.24 480.996 183.86C481.644 185.444 481.968 187.46 481.968 189.908V202.976C481.968 204.092 481.662 204.956 481.05 205.568C480.474 206.144 479.646 206.432 478.566 206.432C477.486 206.432 476.658 206.144 476.082 205.568C475.506 204.956 475.218 204.092 475.218 202.976V190.178C475.218 188.162 474.876 186.686 474.192 185.75C473.544 184.814 472.428 184.346 470.844 184.346C469.08 184.346 467.694 184.976 466.686 186.236C465.678 187.46 465.174 189.17 465.174 191.366V202.976C465.174 204.092 464.886 204.956 464.31 205.568C463.734 206.144 462.906 206.432 461.826 206.432C460.746 206.432 459.9 206.144 459.288 205.568C458.712 204.956 458.424 204.092 458.424 202.976V190.178C458.424 188.162 458.082 186.686 457.398 185.75C456.75 184.814 455.652 184.346 454.104 184.346C452.34 184.346 450.954 184.976 449.946 186.236C448.938 187.46 448.434 189.17 448.434 191.366V202.976C448.434 205.28 447.3 206.432 445.032 206.432ZM497.626 206.54C495.718 206.54 494.008 206.18 492.496 205.46C491.02 204.704 489.85 203.696 488.986 202.436C488.158 201.176 487.744 199.754 487.744 198.17C487.744 196.226 488.248 194.696 489.256 193.58C490.264 192.428 491.902 191.6 494.17 191.096C496.438 190.592 499.48 190.34 503.296 190.34H505.996V194.228H503.35C501.118 194.228 499.336 194.336 498.004 194.552C496.672 194.768 495.718 195.146 495.142 195.686C494.602 196.19 494.332 196.91 494.332 197.846C494.332 199.034 494.746 200.006 495.574 200.762C496.402 201.518 497.554 201.896 499.03 201.896C500.218 201.896 501.262 201.626 502.162 201.086C503.098 200.51 503.836 199.736 504.376 198.764C504.916 197.792 505.186 196.676 505.186 195.416V189.206C505.186 187.406 504.79 186.11 503.998 185.318C503.206 184.526 501.874 184.13 500.002 184.13C498.958 184.13 497.824 184.256 496.6 184.508C495.412 184.76 494.152 185.192 492.82 185.804C492.136 186.128 491.524 186.218 490.984 186.074C490.48 185.93 490.084 185.642 489.796 185.21C489.508 184.742 489.364 184.238 489.364 183.698C489.364 183.158 489.508 182.636 489.796 182.132C490.084 181.592 490.57 181.196 491.254 180.944C492.91 180.26 494.494 179.774 496.006 179.486C497.554 179.198 498.958 179.054 500.218 179.054C502.81 179.054 504.934 179.45 506.59 180.242C508.282 181.034 509.542 182.24 510.37 183.86C511.198 185.444 511.612 187.496 511.612 190.016V202.976C511.612 204.092 511.342 204.956 510.802 205.568C510.262 206.144 509.488 206.432 508.48 206.432C507.472 206.432 506.68 206.144 506.104 205.568C505.564 204.956 505.294 204.092 505.294 202.976V200.384H505.726C505.474 201.644 504.97 202.742 504.214 203.678C503.494 204.578 502.576 205.28 501.46 205.784C500.344 206.288 499.066 206.54 497.626 206.54ZM521.919 206.432C520.803 206.432 519.939 206.144 519.327 205.568C518.751 204.956 518.463 204.092 518.463 202.976V182.564C518.463 181.448 518.751 180.602 519.327 180.026C519.903 179.45 520.713 179.162 521.757 179.162C522.801 179.162 523.611 179.45 524.187 180.026C524.763 180.602 525.051 181.448 525.051 182.564V185.966H524.511C525.015 183.806 526.005 182.168 527.481 181.052C528.957 179.936 530.919 179.27 533.367 179.054C534.123 178.982 534.717 179.18 535.149 179.648C535.617 180.08 535.887 180.764 535.959 181.7C536.031 182.6 535.815 183.338 535.311 183.914C534.843 184.454 534.123 184.778 533.151 184.886L531.963 184.994C529.767 185.21 528.111 185.894 526.995 187.046C525.879 188.162 525.321 189.746 525.321 191.798V202.976C525.321 204.092 525.033 204.956 524.457 205.568C523.881 206.144 523.035 206.432 521.919 206.432ZM553.235 206.54C550.895 206.54 548.933 206.144 547.349 205.352C545.801 204.56 544.649 203.408 543.893 201.896C543.137 200.348 542.759 198.44 542.759 196.172V184.67H539.951C539.087 184.67 538.421 184.454 537.953 184.022C537.485 183.554 537.251 182.924 537.251 182.132C537.251 181.304 537.485 180.674 537.953 180.242C538.421 179.81 539.087 179.594 539.951 179.594H542.759V174.68C542.759 173.564 543.047 172.718 543.623 172.142C544.235 171.566 545.081 171.278 546.161 171.278C547.241 171.278 548.069 171.566 548.645 172.142C549.221 172.718 549.509 173.564 549.509 174.68V179.594H555.233C556.097 179.594 556.763 179.81 557.231 180.242C557.699 180.674 557.933 181.304 557.933 182.132C557.933 182.924 557.699 183.554 557.231 184.022C556.763 184.454 556.097 184.67 555.233 184.67H549.509V195.794C549.509 197.522 549.887 198.818 550.643 199.682C551.399 200.546 552.623 200.978 554.315 200.978C554.927 200.978 555.467 200.924 555.935 200.816C556.403 200.708 556.817 200.636 557.177 200.6C557.609 200.564 557.969 200.708 558.257 201.032C558.545 201.32 558.689 201.932 558.689 202.868C558.689 203.588 558.563 204.236 558.311 204.812C558.095 205.352 557.681 205.73 557.069 205.946C556.601 206.09 555.989 206.216 555.233 206.324C554.477 206.468 553.811 206.54 553.235 206.54ZM580.628 206.432C579.512 206.432 578.648 206.126 578.036 205.514C577.46 204.866 577.172 203.984 577.172 202.868V171.44C577.172 170.288 577.478 169.424 578.09 168.848C578.702 168.236 579.566 167.93 580.682 167.93H593.696C597.872 167.93 601.094 168.974 603.362 171.062C605.63 173.15 606.764 176.066 606.764 179.81C606.764 183.554 605.63 186.488 603.362 188.612C601.094 190.7 597.872 191.744 593.696 191.744H584.084V202.868C584.084 203.984 583.796 204.866 583.22 205.514C582.644 206.126 581.78 206.432 580.628 206.432ZM584.084 186.29H592.616C595.064 186.29 596.918 185.75 598.178 184.67C599.438 183.554 600.068 181.934 600.068 179.81C600.068 177.686 599.438 176.084 598.178 175.004C596.918 173.924 595.064 173.384 592.616 173.384H584.084V186.29ZM623.446 206.54C620.458 206.54 617.884 205.982 615.724 204.866C613.564 203.75 611.89 202.166 610.702 200.114C609.55 198.062 608.974 195.632 608.974 192.824C608.974 190.088 609.532 187.694 610.648 185.642C611.8 183.59 613.366 181.988 615.346 180.836C617.362 179.648 619.648 179.054 622.204 179.054C624.076 179.054 625.75 179.36 627.226 179.972C628.738 180.584 630.016 181.466 631.06 182.618C632.14 183.77 632.95 185.174 633.49 186.83C634.066 188.45 634.354 190.286 634.354 192.338C634.354 192.986 634.12 193.49 633.652 193.85C633.22 194.174 632.59 194.336 631.762 194.336H614.428V190.448H629.602L628.738 191.258C628.738 189.602 628.486 188.216 627.982 187.1C627.514 185.984 626.812 185.138 625.876 184.562C624.976 183.95 623.842 183.644 622.474 183.644C620.962 183.644 619.666 184.004 618.586 184.724C617.542 185.408 616.732 186.398 616.156 187.694C615.616 188.954 615.346 190.466 615.346 192.23V192.608C615.346 195.56 616.03 197.774 617.398 199.25C618.802 200.69 620.854 201.41 623.554 201.41C624.49 201.41 625.534 201.302 626.686 201.086C627.874 200.834 628.99 200.42 630.034 199.844C630.79 199.412 631.456 199.232 632.032 199.304C632.608 199.34 633.058 199.538 633.382 199.898C633.742 200.258 633.958 200.708 634.03 201.248C634.102 201.752 633.994 202.274 633.706 202.814C633.454 203.354 633.004 203.822 632.356 204.218C631.096 205.01 629.638 205.604 627.982 206C626.362 206.36 624.85 206.54 623.446 206.54ZM651.741 206.54C649.005 206.54 646.629 205.982 644.613 204.866C642.597 203.75 641.031 202.166 639.915 200.114C638.799 198.026 638.241 195.578 638.241 192.77C638.241 190.646 638.547 188.756 639.159 187.1C639.807 185.408 640.725 183.968 641.913 182.78C643.101 181.556 644.523 180.638 646.179 180.026C647.835 179.378 649.689 179.054 651.741 179.054C654.477 179.054 656.853 179.612 658.869 180.728C660.885 181.844 662.451 183.428 663.567 185.48C664.683 187.532 665.241 189.962 665.241 192.77C665.241 194.894 664.917 196.802 664.269 198.494C663.657 200.186 662.757 201.644 661.569 202.868C660.381 204.056 658.959 204.974 657.303 205.622C655.647 206.234 653.793 206.54 651.741 206.54ZM651.741 201.41C653.073 201.41 654.243 201.086 655.251 200.438C656.259 199.79 657.033 198.836 657.573 197.576C658.149 196.28 658.437 194.678 658.437 192.77C658.437 189.89 657.825 187.748 656.601 186.344C655.377 184.904 653.757 184.184 651.741 184.184C650.409 184.184 649.239 184.508 648.231 185.156C647.223 185.768 646.431 186.722 645.855 188.018C645.315 189.278 645.045 190.862 645.045 192.77C645.045 195.614 645.657 197.774 646.881 199.25C648.105 200.69 649.725 201.41 651.741 201.41ZM674.161 216.152C673.081 216.152 672.253 215.864 671.677 215.288C671.101 214.712 670.813 213.866 670.813 212.75V182.564C670.813 181.448 671.101 180.602 671.677 180.026C672.253 179.45 673.063 179.162 674.107 179.162C675.187 179.162 676.015 179.45 676.591 180.026C677.167 180.602 677.455 181.448 677.455 182.564V186.776L676.861 185.156C677.401 183.32 678.499 181.844 680.155 180.728C681.847 179.612 683.809 179.054 686.041 179.054C688.345 179.054 690.361 179.612 692.089 180.728C693.853 181.844 695.221 183.428 696.193 185.48C697.165 187.496 697.651 189.926 697.651 192.77C697.651 195.578 697.165 198.026 696.193 200.114C695.221 202.166 693.871 203.75 692.143 204.866C690.415 205.982 688.381 206.54 686.041 206.54C683.845 206.54 681.919 206 680.263 204.92C678.607 203.804 677.491 202.364 676.915 200.6H677.563V212.75C677.563 213.866 677.257 214.712 676.645 215.288C676.069 215.864 675.241 216.152 674.161 216.152ZM684.151 201.41C685.483 201.41 686.653 201.086 687.661 200.438C688.669 199.79 689.443 198.836 689.983 197.576C690.559 196.28 690.847 194.678 690.847 192.77C690.847 189.89 690.235 187.748 689.011 186.344C687.787 184.904 686.167 184.184 684.151 184.184C682.819 184.184 681.649 184.508 680.641 185.156C679.633 185.768 678.841 186.722 678.265 188.018C677.725 189.278 677.455 190.862 677.455 192.77C677.455 195.614 678.067 197.774 679.291 199.25C680.515 200.69 682.135 201.41 684.151 201.41ZM712.21 206.54C709.222 206.54 706.972 205.694 705.46 204.002C703.948 202.274 703.192 199.754 703.192 196.442V170.9C703.192 169.784 703.48 168.938 704.056 168.362C704.632 167.786 705.46 167.498 706.54 167.498C707.62 167.498 708.448 167.786 709.024 168.362C709.636 168.938 709.942 169.784 709.942 170.9V196.118C709.942 197.774 710.284 198.998 710.968 199.79C711.688 200.582 712.696 200.978 713.992 200.978C714.28 200.978 714.55 200.978 714.802 200.978C715.054 200.942 715.306 200.906 715.558 200.87C716.062 200.798 716.404 200.942 716.584 201.302C716.764 201.626 716.854 202.31 716.854 203.354C716.854 204.254 716.674 204.956 716.314 205.46C715.954 205.964 715.36 206.27 714.532 206.378C714.172 206.414 713.794 206.45 713.398 206.486C713.002 206.522 712.606 206.54 712.21 206.54ZM733.186 206.54C730.198 206.54 727.624 205.982 725.464 204.866C723.304 203.75 721.63 202.166 720.442 200.114C719.29 198.062 718.714 195.632 718.714 192.824C718.714 190.088 719.272 187.694 720.388 185.642C721.54 183.59 723.106 181.988 725.086 180.836C727.102 179.648 729.388 179.054 731.944 179.054C733.816 179.054 735.49 179.36 736.966 179.972C738.478 180.584 739.756 181.466 740.8 182.618C741.88 183.77 742.69 185.174 743.23 186.83C743.806 188.45 744.094 190.286 744.094 192.338C744.094 192.986 743.86 193.49 743.392 193.85C742.96 194.174 742.33 194.336 741.502 194.336H724.168V190.448H739.342L738.478 191.258C738.478 189.602 738.226 188.216 737.722 187.1C737.254 185.984 736.552 185.138 735.616 184.562C734.716 183.95 733.582 183.644 732.214 183.644C730.702 183.644 729.406 184.004 728.326 184.724C727.282 185.408 726.472 186.398 725.896 187.694C725.356 188.954 725.086 190.466 725.086 192.23V192.608C725.086 195.56 725.77 197.774 727.138 199.25C728.542 200.69 730.594 201.41 733.294 201.41C734.23 201.41 735.274 201.302 736.426 201.086C737.614 200.834 738.73 200.42 739.774 199.844C740.53 199.412 741.196 199.232 741.772 199.304C742.348 199.34 742.798 199.538 743.122 199.898C743.482 200.258 743.698 200.708 743.77 201.248C743.842 201.752 743.734 202.274 743.446 202.814C743.194 203.354 742.744 203.822 742.096 204.218C740.836 205.01 739.378 205.604 737.722 206C736.102 206.36 734.59 206.54 733.186 206.54ZM752.68 206.27C751.456 206.27 750.466 205.892 749.71 205.136C748.99 204.38 748.63 203.408 748.63 202.22C748.63 201.068 748.99 200.132 749.71 199.412C750.466 198.656 751.456 198.278 752.68 198.278C753.94 198.278 754.912 198.656 755.596 199.412C756.316 200.132 756.676 201.068 756.676 202.22C756.676 203.408 756.316 204.38 755.596 205.136C754.912 205.892 753.94 206.27 752.68 206.27Z" fill="#016DD3"/>
<defs>
<clipPath id="clip0_2051_176">
<rect width="330" height="100.547" fill="white" transform="translate(0 104.727)"/>
</clipPath>
</defs>
</svg></div>"""
st.sidebar.markdown(svg_logo, unsafe_allow_html=True)

# Upload Documents Section
st.sidebar.header("Upload Documents")
uploaded_files = st.sidebar.file_uploader(
    "Choose files", type=["pdf", "txt", "docx"], accept_multiple_files=True
)

# Function to simulate a toast-like effect
def show_toast(message, duration=2):
    """Display a toast-like message temporarily."""
    with st.empty():
        st.success(message)
        time.sleep(duration)

# Handle file uploads
if uploaded_files:
    uploaded_filenames = []
    for uploaded_file in uploaded_files:
        # Add timestamp to filename for uniqueness
        unique_filename = f"{int(time.time())}_{uploaded_file.name}"
        file_path = os.path.join(UPLOAD_FOLDER, unique_filename)

        # Save each file to disk
        with open(file_path, "wb") as f:
            f.write(uploaded_file.getbuffer())
        uploaded_filenames.append(uploaded_file.name)

    # Display a temporary toast message for successful upload
    show_toast(f"Uploaded {len(uploaded_files)} file(s) successfully!")

# Debugging: Verify uploaded files are saved correctly
    st.sidebar.write("Uploaded Files:", uploaded_filenames)
    for file in uploaded_filenames:
        st.sidebar.write(f"File Path: {os.path.join(UPLOAD_FOLDER, file)}")
        if not os.path.exists(os.path.join(UPLOAD_FOLDER, file)):
            st.sidebar.error(f"File not found at: {os.path.join(UPLOAD_FOLDER, file)}")

# Model Selection
if "list_of_models" not in st.session_state:
    st.session_state["list_of_models"] = get_list_of_models()

selected_model = st.sidebar.selectbox(
    "Select a model:", st.session_state["list_of_models"]
)

# Set up the selected LLM model
if st.session_state.get("ollama_model") != selected_model:
    st.session_state["ollama_model"] = selected_model
    st.session_state["llm"] = Ollama(model=selected_model)

# Index Documents Button
if st.sidebar.button("Index Documents"):
    if uploaded_files:
        with st.spinner("Indexing the uploaded files..."):
            for uploaded_file in uploaded_files:
                # Generate the file path with timestamp
                file_path = os.path.join(UPLOAD_FOLDER, f"{int(time.time())}_{uploaded_file.name}")
                
                # Debug: Verify the file path before indexing
                if not os.path.exists(file_path):
                    st.sidebar.error(f"File not found for indexing: {file_path}")
                    continue

                # Index document
                try:
                    load_documents_into_database(EMBEDDING_MODEL, file_path)
                except Exception as e:
                    st.sidebar.error(f"Error while indexing file {uploaded_file.name}: {e}")
                    continue
        st.sidebar.success("All uploaded documents have been indexed successfully!")
    else:
        st.sidebar.error("No files uploaded. Please upload files first!")

# Initialize Chat History
if "messages" not in st.session_state:
    st.session_state.messages = []

# Display chat messages from history on app rerun
for message in st.session_state.messages:
    with st.chat_message(message["role"]):
        st.markdown(message["content"])

# Handle user input and generate responses
if prompt := st.chat_input("Ask a question:"):
    # Add user query to chat history
    st.session_state.messages.append({"role": "user", "content": prompt})
    with st.chat_message("user"):
        st.markdown(prompt)

    with st.chat_message("assistant"):
        with st.spinner("Thinking..."):
            # Generate response and stream
            stream = getStreamingChain(
                prompt,
                st.session_state.messages,
                st.session_state["llm"],
                st.session_state.get("db"),
            )
            response = st.empty()  # Placeholder for the response text
            for chunk in stream:
                response.markdown(chunk)

# Warning if no database is loaded
if "db" not in st.session_state:
    st.sidebar.warning("Please index documents to enable the chatbot.")
